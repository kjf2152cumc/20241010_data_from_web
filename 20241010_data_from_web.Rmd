---
title: "Data from Web"
author: "Kaleb J. Frierson"
date: "2024-10-10"
output: github_document
---

# Notes

There are two components when looking at a website: 

HTML code with all the information for structure and content (ML = markup language). 

CSS styling side produces what you see. 

There are challenges with extracting what you want from an HTML file. You have to pick out the pieces you want. A big piece of getting data from the web is using a CSS selector: how do you look at a website and figure out from that website what is the correct css tag to give you the actual data that you want and none of the data you don't want. 

* Selector Gadget is the most common tool for finidng the right CSS selector on a page. In a browser, you go to the page you care about, launch SG, click on the things you want. rvest package helps scrape data from the web. 

Workflow:

download HTML using read_html
() 
() 

OR 

In contrast to scraping, you can use an application programming interface (API) which provides a way to communicate with software. Web APIs may give you a way to request specific data from a server. Some API have a download option for CSV. Sometimes this isn't ideal when data changes all the time and you could have code that ALWAYS grabs the most current data and then can run an UTD report. 

Data from the web is messy, it will take a lot of work to figure it out and get it tidy. 


# Coding

## Library Calling

```{r}
library(tidyverse)
library(rvest)
library(httr)

```

## Data From Web

define the url then create an HTML that reads that HTML: 

```{r}
url = "http://samhda.s3-us-gov-west-1.amazonaws.com/s3fs-public/field-uploads/2k15StateFiles/NSDUHsaeShortTermCHG2015.htm"

drug_use_html = read_html(url)

drug_use_html
```
To get the pieces we actually need: 

```{r}
marj_use_df = 
drug_use_html |> 
  html_table() |> 
  first() |> 
  slice(-1) # takes first element out of the table 
```

## Learning Assessment

```{r}
nyc_cost = 
  read_html("https://www.bestplaces.net/cost_of_living/city/new_york/new_york") |>
  html_table(header = TRUE) |>
  first()

nyc_cost
```

## CSS Selectors

```{r}
swm_html = 
  read_html("https://www.imdb.com/list/ls070150896/")
```


```{r}
title_vec = 
  swm_html |>
  html_elements(".ipc-title-link-wrapper .ipc-title__text") |>
  html_text()

metascore_vec = 
  swm_html |>
  html_elements(".metacritic-score-box") |>
  html_text()

runtime_vec = 
  swm_html |>
  html_elements(".dli-title-metadata-item:nth-child(2)") |>
  html_text()

swm_df = 
  tibble(
    title = title_vec,
    score = metascore_vec,
    runtime = runtime_vec)

swm_df
```

## Learning Assessment

```{r}
url = "http://books.toscrape.com"

books_html = read_html(url)

books_titles = 
  books_html |>
  html_elements("h3") |>
  html_text2()

books_stars = 
  books_html |>
  html_elements(".star-rating") |>
  html_attr("class")

books_price = 
  books_html |>
  html_elements(".price_color") |>
  html_text()

books = tibble(
  title = books_titles,
  stars = books_stars,
  price = books_price
)

```

